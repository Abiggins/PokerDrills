const pokerHands =  {
    name: "default",
    hands: [
        { cards:"AA", action:"fold"},
        { cards:"AKs", action:"fold"},
        { cards:"AQs", action:"fold"},
        { cards:"AJs", action:"fold"},
        { cards:"ATs", action:"fold"},
        { cards:"A9s", action:"fold"},
        { cards:"A8s", action:"fold"},
        { cards:"A7s", action:"fold"},
        { cards:"A6s", action:"fold"},
        { cards:"A5s", action:"fold"},
        { cards:"A4s", action:"fold"},
        { cards:"A3s", action:"fold"},
        { cards:"A2s", action:"fold"},
        { cards:"AKo", action:"fold"},
        { cards:"KK", action:"fold"},
        { cards:"KQs", action:"fold"},
        { cards:"KJs", action:"fold"},
        { cards:"KTs", action:"fold"},
        { cards:"K9s", action:"fold"},
        { cards:"K8s", action:"fold"},
        { cards:"K7s", action:"fold"},
        { cards:"K6s", action:"fold"},
        { cards:"K5s", action:"fold"},
        { cards:"K4s", action:"fold"},
        { cards:"K3s", action:"fold"},
        { cards:"K2s", action:"fold"},
        { cards:"AQo", action:"fold"},
        { cards:"KQo", action:"fold"},
        { cards:"QQ", action:"fold"},
        { cards:"QJs", action:"fold"},
        { cards:"QTs", action:"fold"},
        { cards:"Q9s", action:"fold"},
        { cards:"Q8s", action:"fold"},
        { cards:"Q7s", action:"fold"},
        { cards:"Q6s", action:"fold"},
        { cards:"Q5s", action:"fold"},
        { cards:"Q4s", action:"fold"},
        { cards:"Q3s", action:"fold"},
        { cards:"Q2s", action:"fold"},
        { cards:"AJo", action:"fold"},
        { cards:"KJo", action:"fold"},
        { cards:"QJo", action:"fold"},
        { cards:"JJ", action:"fold"},
        { cards:"JTs", action:"fold"},
        { cards:"J9s", action:"fold"},
        { cards:"J8s", action:"fold"},
        { cards:"J7s", action:"fold"},
        { cards:"J6s", action:"fold"},
        { cards:"J5s", action:"fold"},
        { cards:"J4s", action:"fold"},
        { cards:"J3s", action:"fold"},
        { cards:"J2s", action:"fold"},
        { cards:"ATo", action:"fold"},
        { cards:"KTo", action:"fold"},
        { cards:"QTo", action:"fold"},
        { cards:"JTo", action:"fold"},
        { cards:"TT", action:"fold"},
        { cards:"T9s", action:"fold"},
        { cards:"T8s", action:"fold"},
        { cards:"T7s", action:"fold"},
        { cards:"T6s", action:"fold"},
        { cards:"T5s", action:"fold"},
        { cards:"T4s", action:"fold"},
        { cards:"T3s", action:"fold"},
        { cards:"T2s", action:"fold"},
        { cards:"A9o", action:"fold"},
        { cards:"K9o", action:"fold"},
        { cards:"Q9o", action:"fold"},
        { cards:"J9o", action:"fold"},
        { cards:"T9o", action:"fold"},
        { cards:"99", action:"fold"},
        { cards:"98s", action:"fold"},
        { cards:"97s", action:"fold"},
        { cards:"96s", action:"fold"},
        { cards:"95s", action:"fold"},
        { cards:"94s", action:"fold"},
        { cards:"93s", action:"fold"},
        { cards:"92s", action:"fold"},
        { cards:"A8o", action:"fold"},
        { cards:"K8o", action:"fold"},
        { cards:"Q8o", action:"fold"},
        { cards:"J8o", action:"fold"},
        { cards:"T8o", action:"fold"},
        { cards:"98o", action:"fold"},
        { cards:"88", action:"fold"},
        { cards:"87s", action:"fold"},
        { cards:"86s", action:"fold"},
        { cards:"85s", action:"fold"},
        { cards:"84s", action:"fold"},
        { cards:"83s", action:"fold"},
        { cards:"82s", action:"fold"},
        { cards:"A7o", action:"fold"},
        { cards:"K7o", action:"fold"},
        { cards:"Q7o", action:"fold"},
        { cards:"J7o", action:"fold"},
        { cards:"T7o", action:"fold"},
        { cards:"97o", action:"fold"},
        { cards:"87o", action:"fold"},
        { cards:"77", action:"fold"},
        { cards:"76s", action:"fold"},
        { cards:"75s", action:"fold"},
        { cards:"74s", action:"fold"},
        { cards:"73s", action:"fold"},
        { cards:"72s", action:"fold"},
        { cards:"A6o", action:"fold"},
        { cards:"K6o", action:"fold"},
        { cards:"Q6o", action:"fold"},
        { cards:"J6o", action:"fold"},
        { cards:"T6o", action:"fold"},
        { cards:"96o", action:"fold"},
        { cards:"86o", action:"fold"},
        { cards:"76o", action:"fold"},
        { cards:"66", action:"fold"},
        { cards:"65s", action:"fold"},
        { cards:"64s", action:"fold"},
        { cards:"63s", action:"fold"},
        { cards:"62s", action:"fold"},
        { cards:"A5o", action:"fold"},
        { cards:"K5o", action:"fold"},
        { cards:"Q5o", action:"fold"},
        { cards:"J5o", action:"fold"},
        { cards:"T5o", action:"fold"},
        { cards:"95o", action:"fold"},
        { cards:"85o", action:"fold"},
        { cards:"75o", action:"fold"},
        { cards:"65o", action:"fold"},
        { cards:"55", action:"fold"},
        { cards:"54s", action:"fold"},
        { cards:"53s", action:"fold"},
        { cards:"52s", action:"fold"},
        { cards:"A4o", action:"fold"},
        { cards:"K4o", action:"fold"},
        { cards:"Q4o", action:"fold"},
        { cards:"J4o", action:"fold"},
        { cards:"T4o", action:"fold"},
        { cards:"94o", action:"fold"},
        { cards:"84o", action:"fold"},
        { cards:"74o", action:"fold"},
        { cards:"64o", action:"fold"},
        { cards:"54o", action:"fold"},
        { cards:"44", action:"fold"},
        { cards:"43s", action:"fold"},
        { cards:"42s", action:"fold"},
        { cards:"A3o", action:"fold"},
        { cards:"K3o", action:"fold"},
        { cards:"Q3o", action:"fold"},
        { cards:"J3o", action:"fold"},
        { cards:"T3o", action:"fold"},
        { cards:"93o", action:"fold"},
        { cards:"83o", action:"fold"},
        { cards:"73o", action:"fold"},
        { cards:"63o", action:"fold"},
        { cards:"53o", action:"fold"},
        { cards:"43o", action:"fold"},
        { cards:"33", action:"fold"},
        { cards:"32s", action:"fold"},
        { cards:"A2o", action:"fold"},
        { cards:"K2o", action:"fold"},
        { cards:"Q2o", action:"fold"},
        { cards:"J2o", action:"fold"},
        { cards:"T2o", action:"fold"},
        { cards:"92o", action:"fold"},
        { cards:"82o", action:"fold"},
        { cards:"72o", action:"fold"},
        { cards:"62o", action:"fold"},
        { cards:"52o", action:"fold"},
        { cards:"42o", action:"fold"},
        { cards:"32o", action:"fold"},
        { cards:"22", action:"fold"}
    ]
};

let isLeftMouseDown = false;
let isRightMouseDown = false;
let changedButtons = new Set<number>();

function createGrid() {
    const grid = document.getElementById('grid');
    if (!grid) return;

    grid.innerHTML = ''; // Clear existing grid

    pokerHands.hands.forEach((hand, index) => {
        const button = document.createElement('button');
        button.textContent = hand.cards;
        button.className = `grid-button ${hand.action}`;
        button.addEventListener('mousedown', (event) => handleMouseDown(event, index));
        button.addEventListener('mouseover', () => handleMouseOver(index));
        button.addEventListener('contextmenu', (event) => handleRightClick(event, index));
        grid.appendChild(button);
    });

    document.addEventListener('mouseup', handleMouseUp);
}

function handleMouseDown(event: MouseEvent, index: number) {
    if (event.button === 0) { // Left mouse button
        isLeftMouseDown = true;
        changedButtons.clear();
        handleButtonClick(index);
    } else if (event.button === 2) { // Right mouse button
        isRightMouseDown = true;
        changedButtons.clear();
        handleRightClick(event, index);
    }
}

function handleMouseOver(index: number) {
    if (isLeftMouseDown && !changedButtons.has(index)) {
        handleButtonClick(index);
    } else if (isRightMouseDown && !changedButtons.has(index)) {
        handleRightClick(new MouseEvent('contextmenu'), index);
    }
}

function handleMouseUp() {
    isLeftMouseDown = false;
    isRightMouseDown = false;
    changedButtons.clear();
}

function handleButtonClick(index: number) {
    changedButtons.add(index);
    const hand = pokerHands.hands[index];
    const actions = ['fold', 'call', 'raise', 'all-in'];
    const currentActionIndex = actions.indexOf(hand.action);
    const nextActionIndex = (currentActionIndex + 1) % actions.length;
    hand.action = actions[nextActionIndex];

    const button = document.querySelectorAll('.grid-button')[index];
    button.className = `grid-button ${hand.action}`;
}

function handleRightClick(event: MouseEvent, index: number) {
    event.preventDefault();
    changedButtons.add(index);
    const hand = pokerHands.hands[index];
    const actions = ['fold', 'call', 'raise', 'all-in'];
    const currentActionIndex = actions.indexOf(hand.action);
    const prevActionIndex = (currentActionIndex - 1 + actions.length) % actions.length;
    hand.action = actions[prevActionIndex];

    const button = document.querySelectorAll('.grid-button')[index];
    button.className = `grid-button ${hand.action}`;
}

function handleGenerateClick() {
    const rangeNameInput = document.getElementById('range-name') as HTMLInputElement;
    const rangeName = rangeNameInput.value.trim() || 'default_range_name';
    const json = JSON.stringify(pokerHands, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `${rangeName}.json`;
    a.click();
    URL.revokeObjectURL(url);
}

function handleFileUpload(event: Event) {
    const input = event.target as HTMLInputElement;
    if (!input.files?.length) return;

    const file = input.files[0];
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const json = JSON.parse(e.target?.result as string);
            if (json.hands) {
                pokerHands.hands = json.hands;
                createGrid();
            } else {
                alert('Invalid JSON file');
            }
        } catch (error) {
            alert('Error reading JSON file');
        }
    };
    reader.readAsText(file);
}

function toggleGridVisibility() {
    const grid = document.getElementById('grid');
    const chevron = document.getElementById('chevron');
    if (grid && chevron) {
        grid.classList.toggle('expanded');
        chevron.classList.toggle('expanded');
        chevron.innerHTML = grid.classList.contains('expanded') ? '&#9650;' : '&#9660;'; // Upward chevron when expanded
    }
    
}

document.addEventListener('DOMContentLoaded', () => {
    createGrid();
    const generateButton = document.getElementById('generate');
    if (generateButton) {
        generateButton.addEventListener('click', handleGenerateClick);
    }
    const uploadInput = document.getElementById('upload');
    if (uploadInput) {
        uploadInput.addEventListener('change', handleFileUpload);
    }
    const gridContainer = document.getElementById('grid-header');
    if (gridContainer) {
        gridContainer.addEventListener('click', toggleGridVisibility);
    }
});